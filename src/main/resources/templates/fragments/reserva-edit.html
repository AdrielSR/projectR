<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<body th:fragment="copy">

<div class="container">
    <div class="row">
		<div class="col s12">
		
		    <h4 class="center">Editar Reserva</h4>
		    <form>
		        <input type="hidden" id="idReserva" th:value="${reserva.espacio.id}"/>
		        <input type="hidden" id="idEspacio" th:value="${reserva.espacio.id}"/>
		        <div class="col s6">
		            <div>
		                <label> Asunto :
		                    <input type="text" id="asunto" th:value="${reserva.asunto}"/>
		                </label>
		            </div>
		            <div>
		                <label> Desde:
		                    <input type="text" id="datetimepicker1" th:value="${#dates.format(reserva.rango.inicio,'dd/MM/yyy HH:mm')}"/>
		                </label>
		            </div>
		            <div>
		                <label> Hasta:
		                    <input type="text" id="datetimepicker2" th:value="${#dates.format(reserva.rango.fin,'dd/MM/yyy HH:mm')}"/>
		                </label>
		            </div>
		        </div>

				<div class="col s6">
					<label for="autocomplete-users">Invitar usuarios</label>
					<input type="text" id="autocomplete-users" class="autocomplete" />

					<!-- Invitados -->
					<div id="invitados">
						<div class="chip" th:each="i : ${reserva.invitaciones}" th:inline="text" th:attr="data-id-usuario=${i.user.id}">
							<img th:src="@{${i.user.avatar.enlace}}" />
							[[${i.user.username}]] <i class="close material-icons">close</i>
						</div>
					</div>

				</div>

		        <div class="col s12 center">
		            <button id="editar-reserva" class="btn waves-effect waves-light">Guardar</button>
		        </div>
		    </form>
		</div>
	</div>
</div>

<script th:inline="javascript">
    var baseURL = /*[[@{/}]]*/ '/';
    var idReserva = /*[[${reserva.id}]]*/ '1';


    $("#autocomplete-users").autocomplete({
        source: function(request, response){
            var term = request.term;

            buscarUsuariosEmpresa(term)
                .done(function (data) {
                    response($.map(data,function(item){

                        var obj = {};
                        obj.label = item.username;
                        obj.value = item.email;
                        obj.id = item.id;
                        obj.enlaceImagen = item.enlaceImagen;

                        return obj;

                    }))


                })
                .fail(function (xhr, status) {
                    var error = JSON.parse(xhr.responseText);
                    console.log(error.msg);
                });
        },
        select: function(evt, ui){
			evt.preventDefault();
            $("#autocomplete-users").val("");
			var nuevoInvitado = '<div class="chip" data-id-usuario="' + ui.item.id + '">' +
								'<img src="' + ui.item.enlaceImagen + '" />' +
								ui.item.label +
								'<i class="close material-icons">close</i></div>';

			$("#invitados").append(nuevoInvitado);
        },
        minLength: 3
    }).autocomplete("instance")._renderItem = function(ul,item){


        var inner_html =  '<div class="row" style="margin-bottom: 0;">' +
								'<div class="col s12">' +
									'<div class="col s2">' +
										'<img src="' + item.enlaceImagen + '"  class="img-avatar-medium" />' +
									'</div>' +
									'<div class="col s10">' +
										'<span class="title">' + item.label + '</span>' +
										'<p style="margin-top: 0; font-size: 14px; color: #BBB;">' + item.value + '</p>' +
									'</div>' +
								'</div>' +
							'</div>';

        return $('<li></li>')
            .data("item.autocomplete", item)
            .append(inner_html)
            .appendTo(ul);

    };


</script>
<script th:src="@{/js/reserva-edit.js}" src="../../js/reserva-edit.js"></script>

</body>
</html>