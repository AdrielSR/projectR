<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<body th:fragment="copy">
	
	<div class="col s12">
		<h4 class="center">Mis Reservas</h4>
		
		<div class="jumbo" th:if="${#lists.isEmpty(reservas)}">
			<h5 class="center-align">
				Uups! Parece que todavia no has hecho ninguna reserva.
			</h5>
		</div>

		<ul class="collection" th:if="${not #lists.isEmpty(reservas)}">
			<li th:each="r : ${reservas}" class="collection-item avatar" th:id="${r.id}">
				<div class="row">
					<div class="col s12">
						<span th:inline="text">[[${#strings.abbreviate(r.asunto,50)}]]</span>
					</div>
				</div>
				
				<div class="row" style="margin-bottom: 0px;">
					<div class="col s12">
						<div class="col s6" style="padding-left: 0px;">
							<p th:inline="text"> <i><b>Donde:</b></i> [[${r.espacio.nombre}]]</p>
						</div>
	
						<div class="col s6" style="padding-left: 0px;">
							<p th:inline="text"> 
								<i><b>Cuando:</b></i> [[${#dates.format(r.rango.inicio,'dd/MM/yyy HH:mm')}]] - 
								[[${#dates.format(r.rango.fin,'HH:mm')}]]
							</p>
						</div>
					</div>					
				</div>

				<a th:attr="data-id=${r.id}" href="#modal1" class="secondary-content"><i class="material-icons">more_vert</i></a>
			</li>
		</ul>

	<!-- Modal Structure -->
	  <div id="modal1" class="modal bottom-sheet">
	    <div class="modal-footer">
	      <a id="link-eliminar" data-id="" class="modal-action modal-close waves-effect waves-green btn-flat red-text">Eliminar</a>
	      <a id="link-editar" href="#!" class="modal-action modal-close waves-effect waves-green btn-flat blue-text">Editar</a>
	    </div>
	  </div>


	</div>


<script th:inline="javascript">
	var baseURL = /*[[@{/}]]*/ '/';
</script>
<script type="text/javascript">
	$(document).ready(function(){
        var token = $("meta[name='_csrf']").attr("content");
        var header = $("meta[name='_csrf_header']").attr("content");
        var reqHeaders = [];
        reqHeaders[header] = token;

		$('.modal').modal();
		
		$('a.secondary-content').click(function(){
			var id_reserva = $(this).attr("data-id");
			
			var url_editar = "/reserva/" + id_reserva;
			$("#link-editar").attr("href", url_editar);

			$("#link-eliminar").attr("data-id", id_reserva);
		});

        $('#link-eliminar').click(function(){
			if(confirm("Quieres eliminar esta reserva?")){
			    var idReserva = $(this).attr("data-id");
			    eliminarReserva(idReserva, reqHeaders);
			}
        });

		
	});

	function eliminarReserva(idReserva, reqHeaders){
        $.ajax({
            url: baseURL + 'eliminar-reserva',
            method: 'POST',
            headers: reqHeaders,
            data: JSON.stringify(idReserva),
            contentType: 'application/json'
        })
		.done(function () {

			$("#" + idReserva).remove();
		})
		.fail(function (xhr, status) {
			var error = JSON.parse(xhr.responseText);
			console.log(error.msg);
		});
	}
	
</script>

	
</body>
</html>