<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<body th:fragment="copy">
<!-- Info Panel -->
<div class="info-panel">  </div>

<!-- Title Panel -->
<div class="title-panel center">
    <span>Mis Invitaciones</span>
</div>

<div class="container">
    <div class="row">
        <div class="col s12">

            <div class="jumbo" th:if="${#lists.isEmpty(invitaciones)}">
                <h5 class="center-align">
                    Uups! Parece que todavia no tienes invitaciones.
                </h5>
            </div>

            <ul class="collection" th:if="${not #lists.isEmpty(invitaciones)}">
                <li th:each="i : ${invitaciones}" class="collection-item avatar" style="min-height: 63px;">
                    <div class="row">
                        <div class="col s12 m7">
                            <span th:inline="text">
                                [[${#strings.capitalize(i.reserva.user.username)}]], te ha invitado a una reunión el día [[${#dates.format(i.reserva.inicio,'dd/MM/yyy')}]]
                                a las [[${#dates.format(i.reserva.inicio,'HH:mm')}]].
                            </span>
                        </div>

                        <div class="col s12 m5 respuestas">
                            <a th:each="respuesta : ${respuestas}" class="btn-flat right"
                               th:classappend="${respuesta == i.respuesta ? 'respuesta-seleccionada' : ''}"
                               th:attr="data-respuesta=${respuesta}, data-id-reserva=${i.reserva.id}"
                               th:text="${respuesta.name}"></a>
                        </div>

                    </div>

                </li>
            </ul>



        </div>

    </div>
</div>
<script th:inline="javascript">
    var baseURL = /*[[@{/}]]*/ '/';
</script>
<script>

    $(document).ready(function(){

        $("div.respuestas a").click(function(){

            var $respuestaSeleccionada = $(this);

            var idReserva = $respuestaSeleccionada.data("id-reserva");
            var respuesta = $respuestaSeleccionada.data("respuesta");

            var invitacionDTO = {};
            invitacionDTO.idReserva = idReserva;
            invitacionDTO.respuesta = respuesta;

            responderInvitacion(invitacionDTO);
            marcarRespuestaSeleccionada($respuestaSeleccionada);

        });



    });

    function responderInvitacion(invitacionDTO){
        $.ajax({
            url: baseURL + 'responder-invitacion',
            method: 'POST',
            data: JSON.stringify(invitacionDTO),
            contentType: 'application/json'
        })
        .done(function () {

        })
        .fail(function (xhr, status) {
            alert(status);
        });
    }

    function marcarRespuestaSeleccionada($respuestaSeleccionada) {
        $respuestaSeleccionada.parent().children().each(function(){
           $(this).removeClass('respuesta-seleccionada')
        });

        $respuestaSeleccionada.addClass('respuesta-seleccionada');
    }

</script>

</body>
</html>